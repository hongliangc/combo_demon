# ä¿¡å·é©±åŠ¨æ¶æ„

> **æ–‡æ¡£ç±»å‹**: æ ¸å¿ƒæ¶æ„ - ä¿¡å·é©±åŠ¨
> **åˆ›å»ºæ—¥æœŸ**: 2026-01-20
> **Godotç‰ˆæœ¬**: 4.4.1
> **æ¶æ„æ¨¡å¼**: è§‚å¯Ÿè€…æ¨¡å¼ (Observer Pattern)

---

## ğŸ“‹ æ¶æ„æ¦‚è¿°

### è®¾è®¡ç›®æ ‡

ä¿¡å·é©±åŠ¨æ¶æ„é€šè¿‡Godotå†…ç½®çš„ä¿¡å·ç³»ç»Ÿå®ç°ç»„ä»¶é—´è§£è€¦é€šä¿¡ï¼š

- âœ… **é›¶è€¦åˆ**: å‘é€è€…ä¸çŸ¥é“æ¥æ”¶è€…ï¼Œæ¥æ”¶è€…ä¸ä¾èµ–å‘é€è€…
- âœ… **ä¸€å¯¹å¤š**: ä¸€ä¸ªä¿¡å·å¯ä»¥è¢«å¤šä¸ªå¯¹è±¡ç›‘å¬
- âœ… **åŠ¨æ€ç»‘å®š**: è¿è¡Œæ—¶è¿æ¥/æ–­å¼€ä¿¡å·
- âœ… **ç±»å‹å®‰å…¨**: æ”¯æŒç±»å‹åŒ–å‚æ•°

### æ ¸å¿ƒç†å¿µ

```
ç›´æ¥è°ƒç”¨ï¼ˆè€¦åˆï¼‰ â†’ ä¿¡å·é€šä¿¡ï¼ˆè§£è€¦ï¼‰

# âŒ ç´§è€¦åˆ
class A:
    var b: B
    func do_something():
        b.handle_event()  # Aä¾èµ–B

# âœ… ä¿¡å·è§£è€¦
class A:
    signal event_occurred
    func do_something():
        event_occurred.emit()  # Aä¸çŸ¥é“è°åœ¨ç›‘å¬

class B:
    func _ready():
        a.event_occurred.connect(handle_event)
```

---

## ğŸ¯ ä¿¡å·å®šä¹‰è§„èŒƒ

### åŸºç¡€ä¿¡å·å®šä¹‰

```gdscript
# æ— å‚æ•°ä¿¡å·
signal died()
signal animation_finished()

# å•å‚æ•°ä¿¡å·
signal health_changed(current_health: float)
signal state_changed(new_state: String)

# å¤šå‚æ•°ä¿¡å·
signal damaged(damage: Damage, attacker_position: Vector2)
signal item_collected(item_type: String, amount: int)
```

### å‘½åè§„èŒƒ

| æ¨¡å¼ | ç¤ºä¾‹ | ç”¨é€” |
|------|------|------|
| **è¿‡å»å¼** | `died`, `damaged`, `collected` | å·²å®Œæˆçš„äº‹ä»¶ |
| **è¿›è¡Œå¼** | `dying`, `attacking` | æ­£åœ¨è¿›è¡Œçš„äº‹ä»¶ |
| **å®Œæˆå¼** | `health_changed`, `state_changed` | çŠ¶æ€å˜åŒ–é€šçŸ¥ |

**æ¨è**ï¼šä½¿ç”¨**è¿‡å»å¼**è¡¨ç¤ºäº‹ä»¶å·²å‘ç”Ÿ

```gdscript
# âœ… æ¨è
signal died()
signal damaged(damage)
signal skill_started(skill_name)

# âŒ é¿å…
signal die()
signal damage(damage)
signal start_skill(skill_name)
```

---

## ğŸ“¡ ä¿¡å·è¿æ¥æ¨¡å¼

### ä¿¡å·é€šä¿¡æµç¨‹ï¼ˆASCIIï¼‰

```
ç»„ä»¶Aï¼ˆå‘é€è€…ï¼‰
   â”‚
   â””â”€â†’ signal event_occurred.emit(data)
       â”‚
       â”œâ”€â†’ ç»„ä»¶B._on_event(data)
       â”‚   â””â”€â†’ å¤„ç†é€»è¾‘A âœ…
       â”‚
       â”œâ”€â†’ ç»„ä»¶C._on_event(data)
       â”‚   â””â”€â†’ å¤„ç†é€»è¾‘B âœ…
       â”‚
       â””â”€â†’ ç»„ä»¶D._on_event(data)
           â””â”€â†’ å¤„ç†é€»è¾‘C âœ…
```

**æ ¸å¿ƒç‰¹ç‚¹**:
- âœ… ä¸€å¯¹å¤šï¼šä¸€ä¸ªä¿¡å·è§¦å‘å¤šä¸ªç›‘å¬è€…
- âœ… è§£è€¦ï¼šç»„ä»¶Aä¸çŸ¥é“è°åœ¨ç›‘å¬
- âœ… å¼‚æ­¥ï¼šç›‘å¬è€…ç‹¬ç«‹å¤„ç†ï¼Œäº’ä¸å½±å“

### 1. åŸºç¡€è¿æ¥

```gdscript
# å‘é€è€…
class_name HealthComponent
extends Node

signal died()
signal health_changed(current: float, maximum: float)

func take_damage(amount: float):
    health -= amount
    health_changed.emit(health, max_health)
    if health <= 0:
        died.emit()

# æ¥æ”¶è€…
func _ready():
    health_comp.died.connect(_on_died)
    health_comp.health_changed.connect(_on_health_changed)
```

### 2. ä¿¡å·è¿æ¥ç”Ÿå‘½å‘¨æœŸï¼ˆASCIIï¼‰

```
èŠ‚ç‚¹åˆå§‹åŒ–
   â”‚
   â””â”€â†’ _ready()
       â”œâ”€â†’ 1. è·å–ä¿¡å·æº
       â”‚   â””â”€â†’ var health = get_node("HealthComponent")
       â”‚
       â”œâ”€â†’ 2. è¿æ¥ä¿¡å·
       â”‚   â””â”€â†’ health.died.connect(_on_died)
       â”‚
       â””â”€â†’ è¿è¡Œæ—¶ï¼š
           â”‚
           â”œâ”€â†’ äº‹ä»¶è§¦å‘
           â”‚   â””â”€â†’ health.take_damage(10)
           â”‚       â””â”€â†’ if health <= 0:
           â”‚           â””â”€â†’ died.emit() âœ…
           â”‚
           â””â”€â†’ å›è°ƒæ‰§è¡Œ
               â””â”€â†’ _on_died()
                   â””â”€â†’ å¤„ç†æ­»äº¡é€»è¾‘ âœ…
```

### 3. é«˜çº§è¿æ¥æ¨¡å¼

```gdscript
# ä¸€æ¬¡æ€§è¿æ¥ï¼ˆè§¦å‘ä¸€æ¬¡åè‡ªåŠ¨æ–­å¼€ï¼‰
animation.animation_finished.connect(_on_anim, CONNECT_ONE_SHOT)

# å»¶è¿Ÿè¿æ¥ï¼ˆä¸‹ä¸€å¸§æ‰§è¡Œï¼‰
health.died.connect(_on_died, CONNECT_DEFERRED)

# Lambdaè¡¨è¾¾å¼ï¼ˆå†…è”é€»è¾‘ï¼‰
button.pressed.connect(func(): print("ç‚¹å‡»"))
health.health_changed.connect(func(cur, max):
    health_bar.value = cur / max * 100
)
```

---

## ğŸ”¥ Damage ä¿¡å·ä¼ é€’é“¾è¯¦è§£

### å®Œæ•´ä¼ é€’è·¯å¾„

Damage ä¿¡å·æ˜¯æœ¬é¡¹ç›®æœ€æ ¸å¿ƒçš„ä¿¡å·é“¾ï¼Œä»æ”»å‡»æ£€æµ‹åˆ°çŠ¶æ€å“åº”ç»å†å¤šä¸ªç»„ä»¶ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DAMAGE ä¿¡å·ä¼ é€’å®Œæ•´é“¾è·¯                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     ç¢°æ’æ£€æµ‹        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚   â”‚  Hitbox   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  Hurtbox  â”‚                          â”‚
â”‚   â”‚ (æ”»å‡»è€…)   â”‚  area_entered      â”‚ (å—å‡»è€…)   â”‚                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  è°ƒç”¨take_damage()  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                           â”‚                                 â”‚
â”‚                                           â”‚ damaged.emit(damage, pos)       â”‚
â”‚                                           â†“                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                  ä¿¡å·è®¢é˜…è€…ï¼ˆç»Ÿä¸€ç»„ä»¶åŒ–æ¶æ„ï¼‰                        â”‚  â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚   â”‚              ç»Ÿä¸€ç»„ä»¶åŒ–æ¶æ„ï¼ˆPlayer/Enemy/Bossï¼‰                    â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚   â”‚  â”‚                    HealthComponent                           â”‚   â”‚  â”‚
â”‚   â”‚  â”‚  .take_damage(damage, attacker_pos)                          â”‚   â”‚  â”‚
â”‚   â”‚  â”‚  â”œâ”€ æ— æ•ŒçŠ¶æ€æ£€æŸ¥                                              â”‚   â”‚  â”‚
â”‚   â”‚  â”‚  â”œâ”€ æ‰£é™¤ç”Ÿå‘½å€¼                                                â”‚   â”‚  â”‚
â”‚   â”‚  â”‚  â”œâ”€ æ›´æ–°è¡€æ¡                                                  â”‚   â”‚  â”‚
â”‚   â”‚  â”‚  â”œâ”€ æ˜¾ç¤ºä¼¤å®³æ•°å­—ï¼ˆæ”¯æŒæš´å‡»ï¼‰                                   â”‚   â”‚  â”‚
â”‚   â”‚  â”‚  â”œâ”€ åº”ç”¨æ”»å‡»ç‰¹æ•ˆï¼ˆå‡»é£/å‡»é€€ï¼‰                                  â”‚   â”‚  â”‚
â”‚   â”‚  â”‚  â””â”€ å‘å‡º damaged ä¿¡å·                                         â”‚   â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚                                      â”‚
â”‚                                     â”‚ damaged ä¿¡å·                         â”‚
â”‚                                     â†“                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                      BaseStateMachine                                â”‚  â”‚
â”‚   â”‚  _setup_signals():                                                   â”‚  â”‚
â”‚   â”‚      owner_node.damaged.connect(_on_owner_damaged)                   â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚  _on_owner_damaged(damage, attacker_pos):                            â”‚  â”‚
â”‚   â”‚      current_state.on_damaged(damage, attacker_pos)                  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚                                     â”‚
â”‚                                      â†“                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                    å½“å‰çŠ¶æ€ (å¦‚ StunState)                           â”‚  â”‚
â”‚   â”‚  on_damaged(damage, attacker_pos):                                   â”‚  â”‚
â”‚   â”‚      â”œâ”€ æ£€æŸ¥å‡»é£ç‰¹æ•ˆ (KnockUpEffect)                                 â”‚  â”‚
â”‚   â”‚      â”œâ”€ æ£€æŸ¥å‡»é€€ç‰¹æ•ˆ (KnockBackEffect)                               â”‚  â”‚
â”‚   â”‚      â””â”€ é‡ç½®çœ©æ™•è®¡æ—¶å™¨                                               â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å„ç»„ä»¶èŒè´£

| ç»„ä»¶ | èŒè´£ | ä¿¡å·ç±»å‹ |
|------|------|----------|
| **Hitbox** | æ”»å‡»æ£€æµ‹ï¼Œç¢°æ’æ—¶è°ƒç”¨ `take_damage()` | æ— ï¼ˆç›´æ¥æ–¹æ³•è°ƒç”¨ï¼‰ |
| **Hurtbox** | å—å‡»åŒºåŸŸï¼Œè½¬å‘ä¼¤å®³ä¿¡å· | å‘å‡º `damaged` |
| **HealthComponent** | ç»Ÿä¸€ä¼¤å®³å¤„ç†ï¼šæ‰£è¡€ã€è¡€æ¡ã€ç‰¹æ•ˆã€ä¼¤å®³æ•°å­— | ç›‘å¬ Hurtbox + å‘å‡º `damaged` |
| **Enemy/Boss/Player** | è½¬å‘ damaged ä¿¡å·ç»™çŠ¶æ€æœº | ç›‘å¬ HealthComponent + å‘å‡º `damaged` |
| **BaseStateMachine** | è½¬å‘ä¼¤å®³åˆ°å½“å‰çŠ¶æ€ | ç›‘å¬ owner çš„ `damaged` |
| **StunState** | å¤„ç†å‡»é£/å‡»é€€å“åº”ã€é‡ç½®è®¡æ—¶å™¨ | æ¥æ”¶ `on_damaged()` å›è°ƒ |

### æ ¸å¿ƒä»£ç ç¤ºä¾‹

#### 1. Hitbox æ£€æµ‹ç¢°æ’

```gdscript
# Util/Components/hitbox.gd
func _on_hitbox_area_entered_(area: Area2D):
    update_attack()
    if area is Hurtbox:
        # å…³é”®ï¼šè°ƒç”¨ Hurtbox çš„ take_damage æ–¹æ³•
        area.take_damage(damage, attacker_position)
```

#### 2. Hurtbox å‘å‡ºä¿¡å·

```gdscript
# Util/Components/hurtbox.gd
signal damaged(damage: Damage, attacker_position: Vector2)

func take_damage(damage: Damage, attacker_position: Vector2 = Vector2.ZERO):
    # å…³é”®ï¼šå‘å‡º damaged ä¿¡å·ï¼Œä¸ç›´æ¥å¤„ç†ä¼¤å®³
    damaged.emit(damage, attacker_position)
```

#### 3. Enemy/Boss è¿æ¥å¹¶è½¬å‘

```gdscript
# Scenes/enemies/boss/Scripts/boss.gd
func _ready() -> void:
    var hurtbox = get_node_or_null("Hurtbox")
    if hurtbox:
        # å…³é”®ï¼šè¿æ¥ Hurtbox çš„ damaged ä¿¡å·
        hurtbox.damaged.connect(on_damaged)

func on_damaged(damage: Damage, attacker_position: Vector2 = Vector2.ZERO):
    # 1. æ˜¾ç¤ºä¼¤å®³æ•°å­—
    display_damage_number(damage)

    # 2. åº”ç”¨æ”»å‡»ç‰¹æ•ˆï¼ˆå‡»é£ã€å‡»é€€ç­‰ï¼‰
    damage.apply_effects(self, attacker_position)

    # 3. å…³é”®ï¼šå‘å‡ºè‡ªå·±çš„ damaged ä¿¡å·ç»™çŠ¶æ€æœº
    damaged.emit(damage, attacker_position)
```

#### 4. çŠ¶æ€æœºç›‘å¬å¹¶è½¬å‘

```gdscript
# Util/StateMachine/base_state_machine.gd
func _setup_signals() -> void:
    # å…³é”®ï¼šè¿æ¥ owner çš„ damaged ä¿¡å·
    if owner_node and owner_node.has_signal("damaged"):
        owner_node.damaged.connect(_on_owner_damaged)

func _on_owner_damaged(damage: Damage, attacker_position: Vector2 = Vector2.ZERO):
    # å…³é”®ï¼šè½¬å‘ç»™å½“å‰çŠ¶æ€
    if current_state and current_state.has_method("on_damaged"):
        current_state.on_damaged(damage, attacker_position)
```

#### 5. StunState å¤„ç†å‡»é£/å‡»é€€

```gdscript
# Util/StateMachine/CommonStates/stun_state.gd
func on_damaged(damage: Damage, attacker_position: Vector2) -> void:
    # æ£€æŸ¥å¹¶å¤„ç†å‡»é£ç‰¹æ•ˆ
    if damage.has_effect("KnockUpEffect"):
        # ç‰¹æ•ˆå·²åœ¨ Enemy.on_damaged ä¸­åº”ç”¨
        if stun_timer and reset_on_damage:
            stun_timer.start()  # é‡ç½®çœ©æ™•æ—¶é—´

    # æ£€æŸ¥å¹¶å¤„ç†å‡»é€€ç‰¹æ•ˆ
    if damage.has_effect("KnockBackEffect"):
        if stun_timer and reset_on_damage:
            stun_timer.start()
```

---

## ğŸ¯ Hitbox/Hurtbox ç¢°æ’æ£€æµ‹æ¶æ„

### æ¦‚è¿°

Hitbox/Hurtbox æ˜¯æˆ˜æ–—ç³»ç»Ÿçš„åŸºç¡€ç¢°æ’æ£€æµ‹ç»„ä»¶ï¼Œé‡‡ç”¨**æ–¹æ³•è°ƒç”¨ + ä¿¡å·å‘å°„**çš„æ··åˆæ¨¡å¼ï¼š

- **Hitbox**: æ”»å‡»åŒºåŸŸï¼ˆå­å¼¹ã€æ­¦å™¨ï¼‰ï¼Œæ£€æµ‹åˆ°ç¢°æ’å**è°ƒç”¨æ–¹æ³•**
- **Hurtbox**: å—å‡»åŒºåŸŸï¼ˆè§’è‰²èº«ä½“ï¼‰ï¼Œè¢«è°ƒç”¨å**å‘å‡ºä¿¡å·**

### å®Œæ•´ç¢°æ’æ£€æµ‹æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     HITBOX/HURTBOX ç¢°æ’æ£€æµ‹å®Œæ•´æµç¨‹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚   Hitbox      â”‚   Godot ç‰©ç†å¼•æ“       â”‚   Hurtbox     â”‚                â”‚
â”‚   â”‚  (Area2D)     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   (Area2D)    â”‚                â”‚
â”‚   â”‚ collision_maskâ”‚   ç¢°æ’å±‚åŒ¹é…æ£€æµ‹        â”‚collision_layerâ”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚           â”‚                                                                 â”‚
â”‚           â”‚ area_entered ä¿¡å·è§¦å‘                                           â”‚
â”‚           â†“                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Hitbox._on_hitbox_area_entered_(area)                              â”‚  â”‚
â”‚   â”‚  â”œâ”€ 1. æ£€æŸ¥å¿½ç•¥ç¢°æ’ç»„ (ignore_collision_groups)                     â”‚  â”‚
â”‚   â”‚  â”œâ”€ 2. update_attack() - ç”Ÿæˆéšæœºä¼¤å®³å€¼                             â”‚  â”‚
â”‚   â”‚  â”œâ”€ 3. if area is Hurtbox:                                          â”‚  â”‚
â”‚   â”‚  â”‚      area.take_damage(damage)  â—„â”€â”€ ã€æ–¹æ³•è°ƒç”¨ï¼Œéä¿¡å·ã€‘           â”‚  â”‚
â”‚   â”‚  â””â”€ 4. if destroy_owner_on_hit: queue_free()                        â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â”‚                                            â”‚
â”‚                                â”‚ æ–¹æ³•è°ƒç”¨                                   â”‚
â”‚                                â†“                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Hurtbox.take_damage(damage, attacker_position)                     â”‚  â”‚
â”‚   â”‚  â””â”€ damaged.emit(damage, attacker_position)  â—„â”€â”€ ã€å‘å‡ºä¿¡å·ã€‘        â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â”‚                                            â”‚
â”‚                                â”‚ damaged ä¿¡å·                               â”‚
â”‚                                â†“                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  HealthComponent.take_damage(damage, attacker_position)             â”‚  â”‚
â”‚   â”‚  â”œâ”€ æ— æ•Œæ£€æŸ¥                                                         â”‚  â”‚
â”‚   â”‚  â”œâ”€ æ‰£è¡€                                                             â”‚  â”‚
â”‚   â”‚  â”œâ”€ å‘å‡º health_changed ä¿¡å· â†’ è¡€æ¡ UI                               â”‚  â”‚
â”‚   â”‚  â”œâ”€ æ˜¾ç¤ºä¼¤å®³æ•°å­—                                                     â”‚  â”‚
â”‚   â”‚  â”œâ”€ apply_attack_effects() â†’ å‡»é£/å‡»é€€ç‰¹æ•ˆ                           â”‚  â”‚
â”‚   â”‚  â””â”€ å‘å‡º damaged ä¿¡å· â†’ å®ä½“/çŠ¶æ€æœº                                  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¢°æ’å±‚é…ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç¢°æ’å±‚é…ç½®ç¤ºä¾‹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ç©å®¶æ”»å‡»æ•Œäºº:                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Player Hitbox    â”‚         â”‚ Enemy Hurtbox    â”‚             â”‚
â”‚  â”‚ collision_mask=8 â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚ collision_layer=8â”‚             â”‚
â”‚  â”‚ (æ£€æµ‹ç¬¬4å±‚)       â”‚         â”‚ (åœ¨ç¬¬4å±‚)         â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                 â”‚
â”‚  æ•Œäººæ”»å‡»ç©å®¶:                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Enemy Hitbox     â”‚         â”‚ Player Hurtbox   â”‚             â”‚
â”‚  â”‚ collision_mask=4 â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚ collision_layer=4â”‚             â”‚
â”‚  â”‚ (æ£€æµ‹ç¬¬3å±‚)       â”‚         â”‚ (åœ¨ç¬¬3å±‚)         â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                 â”‚
â”‚  ç¢°æ’å±‚å®šä¹‰:                                                    â”‚
â”‚  Layer 3 (4)  = Player Hurtbox                                 â”‚
â”‚  Layer 4 (8)  = Enemy Hurtbox                                  â”‚
â”‚  Layer 8 (128)= åœ°å½¢/éšœç¢ç‰©                                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒä»£ç 

#### Hitbox - æ”»å‡»æ£€æµ‹

```gdscript
# Util/Components/hitbox.gd
extends Area2D
class_name Hitbox

@export var damage: Damage = null
@export var destroy_owner_on_hit: bool = false
@export var ignore_collision_groups: Array[String] = []

func _ready() -> void:
    if damage == null:
        damage = Damage.new()
    # è¿æ¥ Godot å†…ç½®çš„ç¢°æ’ä¿¡å·
    area_entered.connect(_on_hitbox_area_entered_)

func update_attack():
    if damage:
        damage.randomize_damage()  # ç”Ÿæˆéšæœºä¼¤å®³

func _on_hitbox_area_entered_(area: Area2D):
    # 1. æ£€æŸ¥å¿½ç•¥ç»„
    for group in ignore_collision_groups:
        if area.is_in_group(group):
            return

    # 2. æ›´æ–°ä¼¤å®³å€¼
    update_attack()

    # 3. ã€å…³é”®ã€‘è°ƒç”¨ Hurtbox çš„æ–¹æ³•ï¼ˆéä¿¡å·ï¼‰
    if area is Hurtbox:
        area.take_damage(damage)

    # 4. å¯é€‰ï¼šå‘½ä¸­åé”€æ¯
    if destroy_owner_on_hit:
        get_owner().queue_free()
```

#### Hurtbox - å—å‡»åŒºåŸŸ

```gdscript
# Util/Components/hurtbox.gd
extends Area2D
class_name Hurtbox

# ã€å…³é”®ã€‘å—ä¼¤ä¿¡å· - é€šçŸ¥ HealthComponent
signal damaged(damage: Damage, attacker_position: Vector2)

func take_damage(damage: Damage, attacker_position: Vector2 = Vector2.ZERO):
    # ã€å…³é”®ã€‘å‘å‡ºä¿¡å·ï¼Œè®© HealthComponent å¤„ç†
    damaged.emit(damage, attacker_position)
```

### ä¿¡å·è¿æ¥é…ç½®

åœ¨å®ä½“çš„ `_setup_signals()` ä¸­è¿æ¥ï¼š

```gdscript
# Enemy/Boss/Player çš„ä¿¡å·è¿æ¥
func _setup_signals() -> void:
    var hurtbox = get_node_or_null("Hurtbox")
    if hurtbox and health_component:
        # ã€å…³é”®ã€‘Hurtbox.damaged â†’ HealthComponent.take_damage
        hurtbox.damaged.connect(health_component.take_damage)
```

### è®¾è®¡é€‰æ‹©è¯´æ˜

| ç¯èŠ‚ | é€šä¿¡æ–¹å¼ | åŸå›  |
|------|----------|------|
| Hitbox â†’ Hurtbox | **æ–¹æ³•è°ƒç”¨** | åŒæ­¥ã€ç«‹å³æ‰§è¡Œï¼Œç¡®ä¿ä¼¤å®³æ•°æ®ä¼ é€’ |
| Hurtbox â†’ HealthComponent | **ä¿¡å·** | è§£è€¦ï¼ŒHurtbox ä¸å…³å¿ƒè°å¤„ç†ä¼¤å®³ |
| HealthComponent â†’ Entity | **ä¿¡å·** | è§£è€¦ï¼Œæ”¯æŒå¤šç§å®ä½“ç±»å‹ |

---

## âš¡ æ”»å‡»ç‰¹æ•ˆä¿¡å·ä¼ é€’æ¶æ„

### æ¦‚è¿°

æ”»å‡»ç‰¹æ•ˆï¼ˆå‡»é£ KnockUpã€å‡»é€€ KnockBack ç­‰ï¼‰é€šè¿‡ Damage èµ„æºçš„ `effects` æ•°ç»„ä¼ é€’ï¼Œåœ¨ HealthComponent ä¸­ç»Ÿä¸€æ‰§è¡Œã€‚

### æ”»å‡»ç‰¹æ•ˆæ‰§è¡Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ”»å‡»ç‰¹æ•ˆå®Œæ•´æ‰§è¡Œæµç¨‹                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚                    Damage èµ„æºé…ç½®                                    â”‚â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚   â”‚  â”‚ Damage.tres                                                     â”‚ â”‚â”‚
â”‚   â”‚  â”‚ â”œâ”€ min_amount: 10                                               â”‚ â”‚â”‚
â”‚   â”‚  â”‚ â”œâ”€ max_amount: 20                                               â”‚ â”‚â”‚
â”‚   â”‚  â”‚ â””â”€ effects: [                                                   â”‚ â”‚â”‚
â”‚   â”‚  â”‚      â”œâ”€ KnockUpEffect.tres (å‡»é£)                               â”‚ â”‚â”‚
â”‚   â”‚  â”‚      â””â”€ KnockBackEffect.tres (å‡»é€€)                             â”‚ â”‚â”‚
â”‚   â”‚  â”‚    ]                                                            â”‚ â”‚â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â”‚ Hitbox æºå¸¦ Damage                     â”‚
â”‚                                    â†“                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚  HealthComponent.take_damage(damage_data, attacker_position)         â”‚â”‚
â”‚   â”‚  â”œâ”€ 1. æ— æ•Œæ£€æŸ¥                                                       â”‚â”‚
â”‚   â”‚  â”œâ”€ 2. æ‰£è¡€: health -= damage_data.amount                            â”‚â”‚
â”‚   â”‚  â”œâ”€ 3. health_changed.emit() â†’ è¡€æ¡æ›´æ–°                              â”‚â”‚
â”‚   â”‚  â”œâ”€ 4. display_damage_number() â†’ ä¼¤å®³æ•°å­—                            â”‚â”‚
â”‚   â”‚  â”œâ”€ 5. ã€å…³é”®ã€‘apply_attack_effects(damage_data, attacker_position)  â”‚â”‚
â”‚   â”‚  â”‚      â””â”€ éå† effects æ•°ç»„ï¼Œé€ä¸ªåº”ç”¨                                â”‚â”‚
â”‚   â”‚  â””â”€ 6. damaged.emit() â†’ çŠ¶æ€æœºå“åº”                                   â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â”‚ éå†ç‰¹æ•ˆ                               â”‚
â”‚                                    â†“                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚  HealthComponent.apply_attack_effects()                              â”‚â”‚
â”‚   â”‚  for effect in damage_data.effects:                                  â”‚â”‚
â”‚   â”‚      if effect.has_method("apply_effect"):                           â”‚â”‚
â”‚   â”‚          effect.apply_effect(owner_body, attacker_position)          â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                    â”‚                                        â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚               â†“                    â†“                    â†“                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚  KnockUpEffect    â”‚ â”‚  KnockBackEffect  â”‚ â”‚  GatherEffect     â”‚        â”‚
â”‚   â”‚  å‡»é£ç‰¹æ•ˆ          â”‚ â”‚  å‡»é€€ç‰¹æ•ˆ          â”‚ â”‚  èšæ‹¢ç‰¹æ•ˆ          â”‚        â”‚
â”‚   â”‚  â”œâ”€ TweenåŠ¨ç”»     â”‚ â”‚  â”œâ”€ è®¾ç½®velocity  â”‚ â”‚  â”œâ”€ å¸å¼•ç›®æ ‡      â”‚        â”‚
â”‚   â”‚  â”œâ”€ ä¸Šå‡+ä¸‹è½     â”‚ â”‚  â”œâ”€ ç¦ç”¨can_move  â”‚ â”‚  â””â”€ æ”¹å˜position  â”‚        â”‚
â”‚   â”‚  â””â”€ æ¢å¤can_move  â”‚ â”‚  â””â”€ å®šæ—¶æ¢å¤      â”‚ â”‚                   â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç‰¹æ•ˆæ‰§è¡Œä¸çŠ¶æ€æœºå“åº”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç‰¹æ•ˆæ‰§è¡Œ vs çŠ¶æ€æœºå“åº” åˆ†å·¥                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                  HealthComponent (ç‰¹æ•ˆæ‰§è¡Œå±‚)                        â”‚  â”‚
â”‚   â”‚  apply_attack_effects():                                            â”‚  â”‚
â”‚   â”‚      â”œâ”€â†’ KnockUpEffect.apply_effect()   â—„â”€â”€ ã€æ‰§è¡Œå‡»é£åŠ¨ç”»ã€‘         â”‚  â”‚
â”‚   â”‚      â”‚       â”œâ”€ Tween ä¸Šå‡åŠ¨ç”»                                      â”‚  â”‚
â”‚   â”‚      â”‚       â”œâ”€ Tween ä¸‹è½åŠ¨ç”»                                      â”‚  â”‚
â”‚   â”‚      â”‚       â””â”€ è®¾ç½® can_move = false                               â”‚  â”‚
â”‚   â”‚      â”‚                                                              â”‚  â”‚
â”‚   â”‚      â””â”€â†’ KnockBackEffect.apply_effect() â—„â”€â”€ ã€æ‰§è¡Œå‡»é€€ã€‘            â”‚  â”‚
â”‚   â”‚              â”œâ”€ è®¾ç½® velocity                                       â”‚  â”‚
â”‚   â”‚              â””â”€ è®¾ç½® can_move = false                               â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â”‚ damaged ä¿¡å·                           â”‚
â”‚                                    â†“                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                  StunState (çŠ¶æ€å“åº”å±‚)                              â”‚  â”‚
â”‚   â”‚  on_damaged(damage, attacker_position):                             â”‚  â”‚
â”‚   â”‚      if damage.has_effect("KnockUpEffect"):                         â”‚  â”‚
â”‚   â”‚          # ã€ä¸æ‰§è¡Œã€‘å‡»é£ï¼ˆå·²ç”± HealthComponent æ‰§è¡Œï¼‰                â”‚  â”‚
â”‚   â”‚          # ã€ä»…é‡ç½®ã€‘çœ©æ™•è®¡æ—¶å™¨                                       â”‚  â”‚
â”‚   â”‚          stun_timer.start()                                         â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚      if damage.has_effect("KnockBackEffect"):                       â”‚  â”‚
â”‚   â”‚          stun_timer.start()                                         â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚   èŒè´£åˆ†ç¦»:                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ ç»„ä»¶               â”‚ èŒè´£                                          â”‚    â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚   â”‚ KnockUpEffect     â”‚ æ‰§è¡Œ Tween å‡»é£åŠ¨ç”»ã€æ§åˆ¶ can_move             â”‚    â”‚
â”‚   â”‚ KnockBackEffect   â”‚ è®¾ç½® velocityã€æ§åˆ¶ can_move                   â”‚    â”‚
â”‚   â”‚ HealthComponent   â”‚ è§¦å‘ç‰¹æ•ˆæ‰§è¡Œã€å‘å‡º damaged ä¿¡å·                â”‚    â”‚
â”‚   â”‚ StunState         â”‚ å“åº”ä¼¤å®³ã€é‡ç½®çœ©æ™•è®¡æ—¶ã€ç®¡ç†çœ©æ™•çŠ¶æ€           â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒä»£ç 

#### AttackEffect åŸºç±»

```gdscript
# Util/Classes/AttackEffect.gd (å‡è®¾çš„åŸºç±»)
extends Resource
class_name AttackEffect

@export var effect_name: String = ""
@export var duration: float = 0.5
@export var show_debug_info: bool = false

func apply_effect(target: CharacterBody2D, damage_source_position: Vector2) -> void:
    # å­ç±»å®ç°å…·ä½“ç‰¹æ•ˆ
    pass
```

#### KnockUpEffect - å‡»é£ç‰¹æ•ˆ

```gdscript
# Util/Classes/KnockUpEffect.gd
extends AttackEffect
class_name KnockUpEffect

@export var launch_height: float = 80.0
@export var rise_duration: float = 0.25
@export var fall_duration: float = 0.2

func apply_effect(target: CharacterBody2D, damage_source_position: Vector2) -> void:
    var original_position = target.global_position
    var peak_position = Vector2(original_position.x, original_position.y - launch_height)

    # ç¦ç”¨ç§»åŠ¨
    if "can_move" in target:
        target.can_move = false

    # Tween åŠ¨ç”»
    var tween = target.create_tween()
    tween.tween_property(target, "global_position", peak_position, rise_duration) \
        .set_ease(Tween.EASE_OUT).set_trans(Tween.TRANS_QUAD)
    tween.tween_property(target, "global_position", original_position, fall_duration) \
        .set_ease(Tween.EASE_IN).set_trans(Tween.TRANS_QUAD)

    # å®Œæˆåæ¢å¤
    tween.finished.connect(func():
        if is_instance_valid(target) and "can_move" in target:
            if not ("stunned" in target and target.stunned):
                target.can_move = true
    , CONNECT_ONE_SHOT)
```

#### KnockBackEffect - å‡»é€€ç‰¹æ•ˆ

```gdscript
# Util/Classes/KnockBackEffect.gd
extends AttackEffect
class_name KnockBackEffect

@export var knockback_force: float = 200.0

func apply_effect(target: CharacterBody2D, damage_source_position: Vector2) -> void:
    # è®¡ç®—å‡»é€€æ–¹å‘
    var direction = (target.global_position - damage_source_position).normalized()
    target.velocity = direction * knockback_force

    # ç¦ç”¨ç§»åŠ¨
    if "can_move" in target:
        target.can_move = false
        target.get_tree().create_timer(duration).timeout.connect(func():
            if is_instance_valid(target) and "can_move" in target:
                if not ("stunned" in target and target.stunned):
                    target.can_move = true
        , CONNECT_ONE_SHOT)
```

#### HealthComponent è§¦å‘ç‰¹æ•ˆ

```gdscript
# Util/Components/HealthComponent.gd
func apply_attack_effects(damage_data: Damage, attacker_position: Vector2) -> void:
    for effect in damage_data.effects:
        if effect != null:
            if effect.has_method("apply_effect"):
                # ã€å…³é”®ã€‘è°ƒç”¨ç‰¹æ•ˆçš„ apply_effect æ–¹æ³•
                effect.apply_effect(owner_body, attacker_position)
```

### ç‰¹æ•ˆé…ç½®æ–¹å¼

```
# åœ¨ç¼–è¾‘å™¨ä¸­é…ç½® Damage èµ„æº
res://Util/Data/SkillBook/KnockUp.tres
â”œâ”€ min_amount: 15
â”œâ”€ max_amount: 25
â””â”€ effects: [
     â””â”€ res://Util/Effects/KnockUpEffect.tres
         â”œâ”€ launch_height: 80
         â”œâ”€ rise_duration: 0.25
         â””â”€ fall_duration: 0.2
   ]
```

### ç‰¹æ•ˆç±»å‹æ€»ç»“

| ç‰¹æ•ˆç±» | ä½œç”¨ | å®ç°æ–¹å¼ |
|--------|------|----------|
| **KnockUpEffect** | å‡»é£ï¼ˆä¸Šå‡+ä¸‹è½ï¼‰ | Tween åŠ¨ç”»ç§»åŠ¨ position |
| **KnockBackEffect** | å‡»é€€ï¼ˆè¿œç¦»æ”»å‡»è€…ï¼‰ | è®¾ç½® velocity |
| **GatherEffect** | èšæ‹¢ï¼ˆå¸å‘æ”»å‡»è€…ï¼‰ | Tween åŠ¨ç”»ç§»åŠ¨ position |

---

### ç»Ÿä¸€ç»„ä»¶åŒ–æ¶æ„

æ‰€æœ‰å®ä½“ï¼ˆPlayerã€Enemyã€Bossï¼‰ç°åœ¨ç»Ÿä¸€ä½¿ç”¨ HealthComponent å¤„ç†ä¼¤å®³ï¼š

```gdscript
# ============ å®ä½“ç«¯ï¼ˆEnemy/Boss/Playerï¼‰============
func _setup_signals() -> void:
    # 1. è¿æ¥ Hurtbox â†’ HealthComponent
    hurtbox.damaged.connect(health_component.take_damage)

    # 2. ç›‘å¬ HealthComponent ä¿¡å·
    health_component.damaged.connect(_on_health_component_damaged)
    health_component.died.connect(on_death)

func _on_health_component_damaged(damage: Damage, attacker_position: Vector2) -> void:
    # è½¬å‘ç»™çŠ¶æ€æœº
    damaged.emit(damage, attacker_position)

# ============ HealthComponent ç«¯ ============
func take_damage(damage_data: Damage, attacker_position: Vector2) -> void:
    if is_invincible: return      # æ— æ•Œæ£€æŸ¥
    health -= damage_data.amount  # æ‰£è¡€
    update_health_bar()           # æ›´æ–°è¡€æ¡
    display_damage_number()       # æ˜¾ç¤ºä¼¤å®³æ•°å­—
    apply_attack_effects()        # åº”ç”¨å‡»é£/å‡»é€€
    damaged.emit(damage_data, attacker_position)  # é€šçŸ¥å®ä½“
    if health <= 0: die()         # æ­»äº¡æ£€æŸ¥
```

**ä¼˜ç‚¹**ï¼š
- âœ… ç»Ÿä¸€çš„ä¼¤å®³å¤„ç†é€»è¾‘ï¼Œå‡å°‘ä»£ç é‡å¤
- âœ… æ— æ•ŒçŠ¶æ€ã€æš´å‡»æ˜¾ç¤ºç­‰åŠŸèƒ½å¼€ç®±å³ç”¨
- âœ… å®ä½“åªéœ€è½¬å‘ä¿¡å·ç»™çŠ¶æ€æœºï¼ŒèŒè´£æ¸…æ™°

### ä¿¡å·å‘½åè§„èŒƒ

```gdscript
# âœ… ä¿¡å·ä½¿ç”¨è¿‡å»åˆ†è¯ï¼Œè¡¨ç¤º"å·²å—ä¼¤"
signal damaged(damage: Damage, attacker_position: Vector2)

# âœ… å›è°ƒä½¿ç”¨ on_ å‰ç¼€
func on_damaged(damage, pos): ...

# âœ… çŠ¶æ€æœºå†…éƒ¨ä½¿ç”¨ _on_ å‰ç¼€ï¼ˆç§æœ‰æ–¹æ³•ï¼‰
func _on_owner_damaged(damage, pos): ...
```

---

## ğŸ—ï¸ ä¿¡å·æ¶æ„å®ä¾‹

### Playerç‰¹æ®Šæ”»å‡»ä¿¡å·æµï¼ˆASCIIï¼‰

```
ç”¨æˆ·æŒ‰Vé”®
   â”‚
   â””â”€â†’ CombatComponent._process()
       â””â”€â†’ emit skill_started("special_attack")
           â”‚
           â””â”€â†’ SkillManager._on_skill_started()
               â”‚
               â”œâ”€â†’ 1. ç¦ç”¨ç§»åŠ¨
               â”‚   â””â”€â†’ movement.can_move = false
               â”‚
               â”œâ”€â†’ 2. æ’­æ”¾åŠ¨ç”»
               â”‚   â””â”€â†’ animation.play("special_attack")
               â”‚       â””â”€â†’ emit animation_finished
               â”‚           â”‚
               â”‚           â””â”€â†’ 3. ç­‰å¾…å®Œæˆ
               â”‚               â””â”€â†’ await animation_finished âœ…
               â”‚
               â””â”€â†’ 4. æ¢å¤ç§»åŠ¨
                   â””â”€â†’ movement.can_move = true âœ…
```

### ç»„ä»¶äº¤äº’å›¾

```mermaid
graph LR
    subgraph "Input Layer"
        I[ç”¨æˆ·è¾“å…¥]
    end

    subgraph "Combat Layer"
        C[CombatComponent]
    end

    subgraph "Skill Layer"
        S[SkillManager]
    end

    subgraph "Movement Layer"
        M[MovementComponent]
    end

    subgraph "Animation Layer"
        A[AnimationComponent]
    end

    I -->|æŒ‰Vé”®| C
    C -->|skill_started| S
    S -->|ç¦ç”¨| M
    S -->|æ’­æ”¾| A
    A -->|animation_finished| S
    S -->|æ¢å¤| M

    style C fill:#ffcccc
    style S fill:#ccccff
    style M fill:#ccffcc
    style A fill:#ffffcc
```

### æ ¸å¿ƒä»£ç 

```gdscript
# CombatComponent - å‘é€æŠ€èƒ½ä¿¡å·
signal skill_started(skill_name: String)

func _process(delta):
    if Input.is_action_just_pressed("special_attack"):
        skill_started.emit("special_attack")

# SkillManager - ç›‘å¬å¹¶æ‰§è¡Œ
func _ready():
    combat.skill_started.connect(_on_skill_started)

func _on_skill_started(skill_name: String):
    movement.can_move = false
    animation.play(skill_name)
    await animation.animation_finished
    movement.can_move = true
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### âœ… æ¨èæ¨¡å¼

#### 1. ä½¿ç”¨ç±»å‹åŒ–ä¿¡å·

```gdscript
# âœ… ç±»å‹å®‰å…¨
signal damaged(damage: Damage, position: Vector2)

# âŒ æ— ç±»å‹æ£€æŸ¥
signal damaged(damage, position)
```

#### 2. åœ¨_readyä¸­é›†ä¸­è¿æ¥

```gdscript
# âœ… ç»Ÿä¸€ç®¡ç†
func _ready():
    _connect_signals()

func _connect_signals():
    health_component.died.connect(_on_died)
    health_component.damaged.connect(_on_damaged)
    combat_component.skill_started.connect(_on_skill_started)
```

#### 3. è§„èŒƒå›è°ƒå‘½å

```gdscript
# âœ… æ¸…æ™°ï¼š_on_[signal_name]
func _on_died()
func _on_health_changed(cur, max)
func _on_skill_started(skill_name)

# âŒ æ¨¡ç³Š
func handle_death()
func health_update(cur, max)
```

### âŒ å¸¸è§é”™è¯¯

#### 1. ä¿¡å·å¾ªç¯ä¾èµ–

```gdscript
# âŒ é”™è¯¯ï¼šAå’ŒBäº’ç›¸è§¦å‘ â†’ æ­»å¾ªç¯
class A:
    func _on_b():
        event_a.emit()  # è§¦å‘B

class B:
    func _on_a():
        event_b.emit()  # è§¦å‘A â†’ å¾ªç¯ï¼

# âœ… æ­£ç¡®ï¼šä½¿ç”¨æ ‡å¿—ä½é˜²æ­¢å¾ªç¯
class A:
    var is_processing = false

    func _on_b():
        if is_processing: return
        is_processing = true
        event_a.emit()
        is_processing = false
```

#### 2. å¿˜è®°æ–­å¼€ä¿¡å·

```gdscript
# âŒ é”™è¯¯ï¼šèŠ‚ç‚¹é”€æ¯åä¿¡å·ä»è¿æ¥
func _ready():
    some_node.my_signal.connect(_on_signal)

# âœ… æ­£ç¡®ï¼šæ‰‹åŠ¨æ–­å¼€ï¼ˆæ›´å®‰å…¨ï¼‰
func _exit_tree():
    some_node.my_signal.disconnect(_on_signal)
```

**æ³¨æ„**ï¼šGodotä¼šè‡ªåŠ¨æ–­å¼€ï¼Œä½†æ˜¾å¼æ–­å¼€æ›´å®‰å…¨

#### 3. ä¿¡å·å‚æ•°ä¸åŒ¹é…

```gdscript
# âŒ é”™è¯¯ï¼šå‚æ•°æ•°é‡ä¸åŒ¹é…
signal damaged(damage: Damage, position: Vector2)

func _on_damaged(damage):  # âŒ ç¼ºå°‘position
    print(damage)

# âœ… æ­£ç¡®ï¼šå‚æ•°åŒ¹é…
func _on_damaged(damage: Damage, position: Vector2):
    print(damage, position)

# âœ… æˆ–ä½¿ç”¨ä¸‹åˆ’çº¿å¿½ç•¥ä¸éœ€è¦çš„å‚æ•°
func _on_damaged(damage: Damage, _position: Vector2):
    print(damage)
```

---

## ğŸ”„ å¸¸è§ä¿¡å·æ¨¡å¼

### 1. çŠ¶æ€å˜åŒ–é€šçŸ¥

```gdscript
signal health_changed(current: float, maximum: float)
signal state_changed(old_state: String, new_state: String)
signal phase_changed(phase: int)
```

### 2. äº‹ä»¶é€šçŸ¥

```gdscript
signal died()
signal damaged(damage: Damage, attacker_pos: Vector2)
signal skill_started(skill_name: String)
signal animation_finished()
```

### 3. è¯·æ±‚-å“åº”æ¨¡å¼

```gdscript
# å‘é€è¯·æ±‚
signal damage_request(target: Node, damage: Damage)

# å“åº”å¤„ç†
func _ready():
    combat.damage_request.connect(_handle_damage_request)

func _handle_damage_request(target: Node, damage: Damage):
    if target.has_node("HealthComponent"):
        target.get_node("HealthComponent").take_damage(damage)
```

---

## ğŸ“ è®¾è®¡æ¨¡å¼ï¼šè§‚å¯Ÿè€…æ¨¡å¼

ä¿¡å·ç³»ç»Ÿæ˜¯**è§‚å¯Ÿè€…æ¨¡å¼**çš„å®Œç¾å®ç°ï¼š

```
Subject (å‘å¸ƒè€…) â†’ Signal â†’ Observer (è®¢é˜…è€…)
```

**ä¼˜ç‚¹**:
- âœ… æ¾è€¦åˆï¼šSubjectä¸çŸ¥é“Observer
- âœ… åŠ¨æ€è®¢é˜…ï¼šè¿è¡Œæ—¶æ·»åŠ /ç§»é™¤Observer
- âœ… å¹¿æ’­é€šä¿¡ï¼šä¸€ä¸ªäº‹ä»¶é€šçŸ¥å¤šä¸ªObserver

**åº”ç”¨**:
- UIæ›´æ–°ï¼ˆè¡€æ¡ç›‘å¬ç”Ÿå‘½å€¼å˜åŒ–ï¼‰
- æˆå°±ç³»ç»Ÿï¼ˆç›‘å¬ç©å®¶è¡Œä¸ºï¼‰
- éŸ³æ•ˆæ’­æ”¾ï¼ˆç›‘å¬æ¸¸æˆäº‹ä»¶ï¼‰

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç»„ä»¶ç³»ç»Ÿæ¶æ„](03_component_system_architecture.md) - ç»„ä»¶é—´ä¿¡å·é€šä¿¡
- [æˆ˜æ–—ç³»ç»Ÿæ¶æ„](02_combat_system_architecture.md) - Hurtboxä¿¡å·ä¼ é€’
- [çŠ¶æ€æœºæ¶æ„](01_state_machine_architecture.md) - çŠ¶æ€è½¬æ¢ä¿¡å·

---

**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2026-01-27
**Tokenä¼°ç®—**: ~2500
